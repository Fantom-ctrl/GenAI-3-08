# Генерация диалогов на русском языке с использованием модели SambaLingo

## Описание

Скрипт выполняет автоматическую генерацию диалога на русском языке, используя предобученную языковую модель [`sambanovasystems/SambaLingo-Russian-Chat`](https://huggingface.co/sambanovasystems/SambaLingo-Russian-Chat) из библиотеки Transformers.  

Программа позволяет:
- генерировать осмысленные диалоги по заданному промпту;
- автоматически оценивать качество по длине реплик;
- выбирать лучший результат из нескольких попыток;
- сохранять полученный диалог в CSV-файл.

## Основные возможности

- Автогенерация диалогов: модель создает реплики "пользователя" и "ассистента".  
- Многократные попытки: генерация повторяется до достижения пороговой метрики качества.  
- Анализ реплик: оценивается доля коротких ответов (≤ 15 слов).  
- Сохранение результата: финальный диалог сохраняется в CSV-файл с ролями.  
- Использование CUDA: автоматически выбирает GPU, если доступна.

## Структура кода

### `Generator` — основной класс
Отвечает за загрузку модели и генерацию текста.

#### Методы:
- `load_model()` — загружает модель и токенизатор. 
Аргументы: None
Возврат: True — модель успешно загружена, False — произошла ошибка
- `generate_dialog(prompt, max_new_tokens, temperature, top_p, repetition_penalty)` — генерирует ответ модели по запросу. 
Аргументы: prompt — текстовый запрос пользователя, max_new_tokens — максимальное количество токенов для генерации, temperature — контролирует “творчество” модели, чем выше — тем разнообразнее, top_p — nucleus sampling (суммарная вероятность оставшихся токенов ≥ top_p), repetition_penalty — штраф за повторение токенов
Возврат: строка с ответом ассистента, либо None при ошибке

### Вспомогательные функции

#### `split_dialog(text: str)`
Разделяет сгенерированный текст на отдельные реплики, убирая пустые строки.

Аргументы: text — сгенерированный текст диалога
Возврат: список строк с отдельными репликами

#### `check_replicas_length(lines, max_words=15)`
Вычисляет процент коротких реплик и возвращает список слишком длинных.
Аргументы: lines — список реплик, max_words — максимальное число слов, чтобы реплика считалась короткой
Возврат: too_long — список реплик, превышающих max_words, metric — процент реплик, длина которых ≤ max_words

#### `save_result_csv(prompt, dialog, filename="result.csv")`
Сохраняет диалог в CSV-файл с колонками:`Prompt`, `Role` ("User"/"Bot"), `Replica`
Аргументы: prompt — исходный запрос пользователя, dialog — список реплик, filename — имя CSV-файла
Возврат: None

#### `run_dialog_generation(prompt, generator, max_words=15, n_attempts=3, **kwargs)`
Цикл генерации с несколькими попытками и выбором лучшего результата.
Аргументы:

prompt — текст запроса

generator — объект класса Generator

max_words — максимальная длина реплики для метрики

n_attempts — число попыток генерации

**kwargs — параметры генерации (max_new_tokens, temperature, top_p, repetition_penalty)
Возврат: None

## Главная функция

main() – точка входа скрипта, отвечает за взаимодействие с пользователем, запуск основного процесса обработки видео и обработку ошибок.

## Запуск кода

python dialog_generator.py

## Используемые библиотеки

csv - чтения/записи CSV-файлов
torch - библиотека для тензоров и вычислений на GPU/CPU
transformers - класс модели для автогенерации (causal LM) и токенизатор для конвертации текста
logging - модуль для логирования (сообщений об ошибках/информации)
typing - это встроенный модуль Python, предназначенный для указания типов данных

## Установка библиотек

pip install torch transformers
